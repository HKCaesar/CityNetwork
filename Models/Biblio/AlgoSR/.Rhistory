sdCons = append(sd(localCons),sdCons);
lims = append(limits[l],lims);
}
d = data.frame(meanCons,sdCons,lims)
ggplot(d, aes( y= meanCons, x= lims))
+ geom_line()
+ geom_point()
+ geom_errorbar(aes(ymin=meanCons-sdCons, ymax=meanCons+sdCons), width=.2)
+ ggtitle("Lexical consistence = f(keyword limit)")
+ xlab("keyword limit") + ylab("mean consistence")
d = data.frame(meanCons,sdCons,lims)
ggplot(d, aes(colour=1 y= meanCons, x= lims))
+ geom_line()
+ geom_point()
+ geom_errorbar(aes(ymin=meanCons-sdCons, ymax=meanCons+sdCons), width=.2)
+ ggtitle("Lexical consistence = f(keyword limit)")
+ xlab("keyword limit") + ylab("mean consistence")
d = data.frame(meanCons,sdCons,lims)
ggplot(d, aes(colour=1, y= meanCons, x= lims))
+ geom_line()
+ geom_point()
+ geom_errorbar(aes(ymin=meanCons-sdCons, ymax=meanCons+sdCons), width=.2)
+ ggtitle("Lexical consistence = f(keyword limit)")
+ xlab("keyword limit") + ylab("mean consistence")
d = data.frame(meanCons,sdCons,lims)
ggplot(d, aes( y= meanCons, x= lims))
+ geom_line()
+ geom_point()
+ geom_errorbar(aes(ymin=meanCons-sdCons, ymax=meanCons+sdCons), width=.2)
#+ ggtitle("Lexical consistence = f(keyword limit)")
#+ xlab("keyword limit") + ylab("mean consistence")
meanCons
lims
d = data.frame(meanCons,sdCons,lims)
ggplot(d, aes( y= meanCons, x= lims))
ggplot(d, aes( y= meanCons, x= lims))+ geom_line()
+ geom_errorbar(aes(ymin=meanCons-sdCons, ymax=meanCons+sdCons), width=.2)
ggplot(d, aes( y= meanCons, x= lims))+ geom_line()
+ geom_point()
+ geom_errorbar(aes(ymin=meanCons-sdCons, ymax=meanCons+sdCons), width=.2)
d = data.frame(meanCons,sdCons,lims)
ggplot(d, aes( y= meanCons, x= lims))+
geom_line() +
geom_point() +
geom_errorbar(aes(ymin=meanCons-sdCons, ymax=meanCons+sdCons), width=.2) +
ggtitle("Lexical consistence = f(keyword limit)") +
xlab("keyword limit") + ylab("mean consistence")
install.packages("spatstat")
install.packages("spatstat")
library(spatstat)
beginner
vignette('getstart')
vignette('getstart')
library(raster)
install.oackages("raster")
install.packages("raster")
library(raster)
help("raster")
raw <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/bassin_parisien.tif")
install.packages('rgdal')
library(RColorBrewer)
library(rgdal)
library(ggplot2)
install.packages("ggplot2")
install.packages("RColorBrewer")
raw <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/bassin_parisien.tif")
raw <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/bassin_parisien.tif")
raw
help(opening)
w <- as.owin(raw)
w <- owin(raw)
help(im)
w <- owin(im(raw))
im(raw)
help(raster)
im(as.matrix(raw))
w <- owin(im(as.matrix(raw)))
w <- as.owin(im(as.matrix(raw)))
w
as.matrix(w)
as.matrix(w)
opening(w)
opening(w,10)
as.matrix(raw)
help(unique)
unique(raw)
raw
help(find)
binmat<- as.matrix(raw)>10000
sum(binmat)
binmat
binmat<- as.matrix(raw)
binmat
help(as.matrix)
help(dim)
dim(binmat)
help(is.na)
sum(!is.na(as.matrix(raw)))
binmat<- ((!is.na(as.matrix(raw)))%*%as.matrix(raw))>10000
is.na(as.matrix(raw))
help(as.int)
na.omit(as.matrix(raw))
na.omit(c(NA,1))
na.omit(c(NA,1))[1]
binmat<- (na.omit(as.matrix(raw))[1])>10000
sum(binmat)
na.omit(as.matrix(raw))[1]
na.omit(as.matrix(raw))
help(na.omit)
binmat<- (as.matrix(na.omit(as.matrix(raw))))>10000
sum(binmat)
binmat
w <- as.owin(im(as.matrix(raw)))
plot(w)
raw <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/raw/uk-lr.tif")
m = as.matrix(raw)
m[is.na(m)] <- 0
threshold = 10
sum(m>threshold)/length(m)
threshold = 100
sum(m>threshold)/length(m)
binmat<- m>threshold
sum(binmat)/length(m)
w <- owin(mask=binmat)
library(spatstat)
w <- owin(mask=binmat)
radius=3
rep=15
o=w
for(i in 1:rep){
show(paste("it",i))
o <- closing(o,radius)
o <- opening(o,radius)
}
m = as.matrix(o)
library(rlist)
propagate <- function(m,indices,ii,jj,n){
pile = list(c(ii,jj))
while(length(pile)>0){
# unstack first
coords = list.take(pile,1)[[1]] ; pile = list.remove(pile,1);
i=coords[1];j=coords[2];
# update indices
indices[i,j]=n
#stack neighbors of conditions are met
if(i>1){if(indices[i-1,j]==0&&m[i-1,j]==TRUE){pile = list.prepend(pile,c(i-1,j))}}
if(i<nrow(m)){if(indices[i+1,j]==0&&m[i+1,j]==TRUE){pile = list.prepend(pile,c(i+1,j))}}
if(j>1){if(indices[i,j-1]==0&&m[i,j-1]==TRUE){pile = list.prepend(pile,c(i,j-1))}}
if(j<ncol(m)){if(indices[i,j+1]==0&&m[i,j+1]==TRUE){pile = list.prepend(pile,c(i,j+1))}}
}
return(indices)
}
connexAreas <- function(m){
indices <- matrix(data=rep(0,nrow(m)*ncol(m)),nrow=nrow(m),ncol=ncol(m))
maxArea = 0
for(i in 1:nrow(m)){
for(j in 1:ncol(m)){
# if colored but not marked, mark recursively
#   -- necessarily a new area
if(m[i,j]==TRUE&&indices[i,j]==0){
maxArea = maxArea + 1
#show(paste("Prop",i,j," - area ",maxArea))
indices <- propagate(m,indices,i,j,maxArea)
}
}
}
)
)
connexAreas <- function(m){
indices <- matrix(data=rep(0,nrow(m)*ncol(m)),nrow=nrow(m),ncol=ncol(m))
maxArea = 0
for(i in 1:nrow(m)){
for(j in 1:ncol(m)){
# if colored but not marked, mark recursively
#   -- necessarily a new area
if(m[i,j]==TRUE&&indices[i,j]==0){
maxArea = maxArea + 1
#show(paste("Prop",i,j," - area ",maxArea))
indices <- propagate(m,indices,i,j,maxArea)
}
}
}
# use indices to create list of coordinates
areas = list()
for(a in 1:maxArea){
areas=list.append(areas,which(indices==a))
}
return(areas)
}
connexAreas <- function(m){
indices <- matrix(data=rep(0,nrow(m)*ncol(m)),nrow=nrow(m),ncol=ncol(m))
maxArea = 0
for(i in 1:nrow(m)){
for(j in 1:ncol(m)){
# if colored but not marked, mark recursively
#   -- necessarily a new area
if(m[i,j]==TRUE&&indices[i,j]==0){
maxArea = maxArea + 1
show(paste("Prop",i,j," - area ",maxArea))
indices <- propagate(m,indices,i,j,maxArea)
}
}
}
# use indices to create list of coordinates
areas = list()
for(a in 1:maxArea){
areas=list.append(areas,which(indices==a))
}
return(areas)
}
areas = connexAreas(m)
sizes =  unlist(list.apply(areas,length))
sizes
hist(log(sizes),breaks=100)
hist(sizes)
hist(sizes,breaks=100)
help(hist)
help(pdf)
help(hist)
hist(log(sizes),breaks=100,plot=FALSE)
plot(h$mids,log(h$counts))
h = hist(log(sizes),breaks=100,plot=FALSE)
plot(h$mids,log(h$counts))
writeRaster(raster(as.im(o)),paste0("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/processed/uk_closed_opened",radius,"_rep",rep,".tif"),"GTiff")
help(exec)
help('exec')
help('system')
help('Moran')
raw <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/raw/bp_300x500.tif")
raw <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/raw/bp_500x300.tif")
library(raster)
library(rgdal)
raw <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/raw/bp_500x300.tif")
raw <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/raw/bassin_parisien_500x300.tif")
Moran(raw)
Moran(raw,w=matrix(1,10,10))
Moran(raw,w=matrix(1,11,11))
Moran(raw,w=matrix(1,51,51))
Moran(raw,w=matrix(1,101,101))
r <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/raw/bassin_parisien_500x300.tif")
cumsum
cumsum(matrix(1,10,10))
help('rep')
cumsum(matrix(1,1,10))
cumsum(matrix(1,10,1))
rep(cumsum(matrix(1,10,1)),10)
matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1))
N = 10
matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1))
matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1)
matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1) - N
matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1) - N - 1
d = matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1) - N - 1
t(d)
1 / d
1 / (d + t(d))
d = (matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1) - N - 1) ^ 2
d
1 / sqrt(d + t(d))
w = 1 / sqrt(d + t(d))
w[w=Inf]=1
w
w[w==Inf]=1
w
N = 20
d = (matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1) - N - 1) ^ 2
w = 1 / sqrt(d + t(d))
w[w==Inf]=1
Moran(r,w)
N = 10
d = (matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1) - N - 1) ^ 2
w = 1 / sqrt(d + t(d))
w[w==Inf]=1
# Moran with these weights
Moran(r,w)
help(seq)
spatialWeights <- function (N){
d = (matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1) - N - 1) ^ 2
w = 1 / sqrt(d + t(d))
w[w==Inf]=1
return(w)
}
spatialWeights(10)
Moran(r,w)
morans = c()
for(n in seq(from=10,to=100,by=10)){
show(n)
morans = append(morans,Moran(r,n))
}
morans = append(morans,Moran(r,spatialWeights(n)))
morans = c()
for(n in seq(from=10,to=100,by=10)){
show(n)
morans = append(morans,Moran(r,spatialWeights(n)))
}
plot(seq(from=10,to=100,by=10),morans)
for(n in seq(from=110,to=150,by=10)){
show(n)
morans = append(morans,Moran(r,spatialWeights(n)))
}
plot(seq(from=10,to=150,by=10),morans)
raster(matrix(1,10,10))
r <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/raw/bassin_parisien_500x300.tif")
r
m = as.matrix(r)
m[is.na(m)] <- 0
r = raster(m)
r
spatialWeights <- function (N){
d = (matrix(rep(cumsum(matrix(1,2*N+1,1)),2*N+1),nrow=2*N+1) - N - 1) ^ 2
w = 1 / sqrt(d + t(d))
w[w==Inf]=1
return(w)
}
morans = c()
N = seq(from=10,to=50,by=10)
for(n in N){
show(n)
morans = append(morans,Moran(r,spatialWeights(n)))
}
plot(N,morans)
morans = c()
N = seq(from=10,to=150,by=10)
for(n in N){
show(n)
morans = append(morans,Moran(r,spatialWeights(n)))
}
plot(N,morans)
help(permutation)
sample(1:20)
sample(1:20)
sample(1:20)
sample(1:20)
sample(1:20)
sample(1:20)
sample(1:20)
sample(m)
shuffleData <- function(d){
m = as.matrix(d)
m[is.na(m)] <- 0
return(raster(sample(m)))
}
shuffleData(r)
shuffleData <- function(d){
m = as.matrix(d)
m[is.na(m)] <- 0
return(raster(as.matrix(sample(m)))
}
shuffleData <- function(d){
m = as.matrix(d)
m[is.na(m)] <- 0
return(raster(as.matrix(sample(m))))
}
shuffleData(r)
nrows(m)
nrow(m)
shuffleData <- function(d){
m = as.matrix(d)
m[is.na(m)] <- 0
return(raster(as.matrix(sample(m),nrows=nrow(m))))
}
nrow(m)
shuffleData(r)
r <- raster("/Users/Juste/Documents/ComplexSystems/CityNetwork/Data/PopulationDensity/raw/bassin_parisien_500x300.tif")
m = as.matrix(r)
m[is.na(m)] <- 0
r = raster(m)
r
# takes a raster and returns uniformally shuffled data
shuffleData <- function(d){
m = as.matrix(d)
m[is.na(m)] <- 0
return(raster(matrix(sample(m),nrows=nrow(m))))
}
shuffleData(r)
shuffleData <- function(d){
m = as.matrix(d)
m[is.na(m)] <- 0
return(raster(matrix(sample(m),nrow=nrow(m))))
}
shuffleData(r)
N = seq(from=10,to=20,by=10)
Nrep = 1
null_morans = matrix(0,length(N),Nrep)
for(n in 1:length(N)){
show(n)
for(k in 1:Nrep){
null_morans[n,k] = Moran(shuffleData(r),spatialWeights(N[n]))
}
}
null_morans
N = seq(from=10,to=150,by=10)
Nrep = 10
null_morans = matrix(0,length(N),Nrep)
null_morans
for(n in 1:length(N)){
for(k in 1:Nrep){
show(paste(n,' - ',k))
null_morans[n,k] = Moran(shuffleData(r),spatialWeights(N[n]))
}
}
null_morans
mean(null_morans)
help(mean)
man(save)
help(save)
save(null_morans,morans,file="moran.Rdata",ascii=TRUE)
setwd('/Users/Juste/Documents/ComplexSystems/CityNetwork/Models/Biblio/AlgoSR')
d1 <- read.table('junk/refs_city+system+network_16_keywords.csv')
d1 <- read.csv('junk/refs_city+system+network_16_keywords.csv')
d1 <- read.csv('junk/refs_city+system+network_16_keywords.csv',header=TRUE,sep='\t')
d1
d1[1,]
d1[,1]
d1[,5]
files <- c('city+system+network_16','land+use+transport+interaction_8',
'network+urban+modeling_17','population+density+transport_14',
'transportation+network+urban+growth_14'
)
n=length(files)
n
d=list()
for(i in 1:n){
d[[i]]=read.csv(paste('junk/refs_',files[i],'_keywords.csv',header=TRUE,sep='\t'))
}
d=list()
for(i in 1:n){
d[[i]]=read.csv(paste0('junk/refs_',files[i],'_keywords.csv',header=TRUE,sep='\t'))
}
d=list()
for(i in 1:n){
d[[i]]=read.csv(paste0('junk/refs_',files[i],'_keywords.csv'),header=TRUE,sep='\t'))
}
# get data
d=list()
for(i in 1:n){
d[[i]]=read.csv(paste0('junk/refs_',files[i],'_keywords.csv'),header=TRUE,sep='\t')
}
d
d[[1]]
head(d[[1]])
head(d[[2]])
res=matrix(0,n,n)
for(i in 1:n){
for(j in 1:n){
show(j)
if(i != j){
for(k in 1:100){
for(l in 1:100){
if(d[[i]][k,1]==d[[j]][l,1]){res[i,j] = res[i,j] + d[[i]][k,6]/d[[j]][k,6]}
}
}
}
}
}
d[[i]][k,1]
unlist(d[[i]])[k,1]
as.vector(d[[i]])
as.vector(d[[i]])[k,1]
d[[j]][l,1]
help('as.factor')
is.factor(d[[j]][l,1])
as.character(d[[j]][l,1])
res=matrix(0,n,n)
for(i in 1:n){
for(j in 1:n){
show(j)
if(i != j){
for(k in 1:100){
for(l in 1:100){
if(as.character(d[[i]][k,1])==as.character(d[[j]][l,1])){res[i,j] = res[i,j] + d[[i]][k,6]/d[[j]][k,6]}
}
}
}
}
}
res
warnings()
# res
res=matrix(0,n,n)
for(i in 1:n){
for(j in 1:n){
show(j)
if(i != j){
for(k in 1:100){
for(l in 1:100){
if(as.character(d[[i]][k,1])==as.character(d[[j]][l,1])){res[i,j] = res[i,j] + as.numeric(d[[i]][k,6])/as.numeric(d[[j]][k,6])}
}
}
}
}
}
res
res=matrix(0,n,n)
count =matrix(0,n,n)
for(i in 1:n){
for(j in 1:n){
show(j)
if(i != j){
for(k in 1:100){
for(l in 1:100){
if(as.character(d[[i]][k,1])==as.character(d[[j]][l,1])){
res[i,j] = res[i,j] + as.numeric(d[[i]][k,6])/as.numeric(d[[j]][k,6])
count[i,j] = count[i,j]+1
}
}
}
}
}
}
count
count / 100
